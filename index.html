<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="crmTable.html" type="riot/tag"></script>
<script type="text/javascript" src="https://rawgit.com/riot/riot/master/riot%2Bcompiler.min.js"></script>
<style>
</style>
<script>
    items = [];
    tags = [];
    lastModified = undefined;
    function saveItems(){
        $.get("utils.php", {requestType:"write", records: JSON.stringify(items), token: new Date().getTime()}, (data)=>{
            console.log(data);
        });
    }
    function getTags() {
        var nestedTags = items.map(e => e.tags);
        var tags = [];
        nestedTags.forEach(e => {
            tags = tags.concat(e);
        });

        return tags.filter(function (item, pos) {
            return tags.indexOf(item) == pos;
        }).map(tag => tag.name).filter(onlyUnique);
    }

    function getDeadLines() {
        var nestedTags = items.map(e => e.tags);
        var tags = [];
        nestedTags.forEach(e => {
            tags = tags.concat(e);
        });

        return tags.filter(function (item, pos) {
            return tags.indexOf(item) == pos;
        }).map(tag => tag.deadline).filter(onlyUnique);
    }

    function onlyUnique(value, index, self) {
        return self.indexOf(value) === index;
    }

    function getLastId() {
        if(items.length == 0) return 0;
        return Math.max(...items.map(e => e.id));
    }

</script>

<crmTable items={items}></crmTable>

<script>
    riot.mount('*');
</script>